# Требования к системе

## Идентификация требований

Каждое требование имеет уникальный идентификатор:
- **US-XXX** - User Story (функциональное требование)
- **NF-XXX** - Нефункциональное требование
- **TZ-1**, **TZ-2**, **TZ-3** - Группы требований по техническим заданиям

## Акторы системы

1. **Менеджер банка** - управляет правилами рекомендаций
2. **Клиент банка** - получает рекомендации через API и Telegram бота
3. **Внешняя система** - сбрасывает кэш, собирает метрики
4. **Telegram Bot** - автоматизированный агент для взаимодействия с клиентами

## Диаграмма вариантов использования

![Use Case Diagram](../docs/images/use-case-diagram.png)

*Диаграмма показывает взаимодействие акторов с системой*

## Функциональные требования (User Stories)

### ТЗ-1: Базовые рекомендации
**US-1.1**: Система должна рекомендовать продукт "Invest 500" пользователям, которые:
- Используют хотя бы один DEBIT продукт
- Не используют INVEST продукты
- Имеют сумму пополнений SAVING продуктов > 1000 ₽
  *Идентификатор требования: US-1.1*

**US-1.2**: Система должна рекомендовать продукт "Top Saving" пользователям, которые:
- Используют хотя бы один DEBIT продукт
- Имеют сумму пополнений DEBIT или SAVING продуктов ≥ 50 000 ₽
- Сумма пополнений DEBIT продуктов больше суммы трат
  *Идентификатор требования: US-1.2*

**US-1.3**: Система должна рекомендовать продукт "Простой кредит" пользователям, которые:
- Не используют CREDIT продукты
- Сумма пополнений DEBIT продуктов больше суммы трат
- Сумма трат по DEBIT продуктам > 100 000 ₽
  *Идентификатор требования: US-1.3*

**US-1.4**: Система должна предоставлять API для получения рекомендаций по ID пользователя
*Идентификатор требования: US-1.4*

### ТЗ-2: Динамические правила
**US-2.1**: Менеджер должен иметь возможность создавать новые правила рекомендаций через REST API
*Идентификатор требования: US-2.1*

**US-2.2**: Менеджер должен иметь возможность просматривать список всех правил
*Идентификатор требования: US-2.2*

**US-2.3**: Менеджер должен иметь возможность обновлять существующие правила
*Идентификатор требования: US-2.3*

**US-2.4**: Менеджер должен иметь возможность удалять правила
*Идентификатор требования: US-2.4*

**US-2.5**: Система должна кэшировать результаты SQL-запросов правил для повышения производительности
*Идентификатор требования: US-2.5*

**US-2.6**: Кэш должен автоматически инвалидироваться при изменении правил
*Идентификатор требования: US-2.6*

### ТЗ-3: Расширенные функции
**US-3.1**: Система должна предоставлять Telegram бота для получения рекомендаций по имени пользователя
*Идентификатор требования: US-3.1*

**US-3.2**: Бот должен обрабатывать команду `/recommend <username>`
*Идентификатор требования: US-3.2*

**US-3.3**: Система должна вести статистику срабатываний динамических правил
*Идентификатор требования: US-3.3*

**US-3.4**: Менеджер должен иметь возможность просматривать статистику через API
*Идентификатор требования: US-3.4*

**US-3.5**: Система должна предоставлять endpoint для сброса кэша рекомендаций
*Идентификатор требования: US-3.5*

**US-3.6**: Система должна предоставлять информацию о версии сервиса
*Идентификатор требования: US-3.6*

## Нефункциональные требования

**NF-1**: Время ответа API рекомендаций не должно превышать 500 мс при 95-м перцентиле
*Идентификатор требования: NF-1*

**NF-2**: Система должна обрабатывать до 1000 запросов в минуту
*Идентификатор требования: NF-2*

**NF-3**: SQL-запросы должны быть оптимизированы и использовать индексы
*Идентификатор требования: NF-3*

**NF-4**: Кэширование должно снижать нагрузку на БД на 80%
*Идентификатор требования: NF-4*

**NF-5**: Телеграм бот должен отвечать в течение 2 секунд
*Идентификатор требования: NF-5*

**NF-6**: Статические правила из ТЗ-1 должны быть реализованы либо как динамические, либо непосредственно в коде
*Идентификатор требования: NF-6*

**NF-7**: Документация API должна быть доступна в формате OpenAPI 3.0
*Идентификатор требования: NF-7*

**NF-8**: Система должна логировать все ошибки и важные события
*Идентификатор требования: NF-8*

**NF-9**: Конфигурация должна поддерживать переменные окружения для развертывания
*Идентификатор требования: NF-9*

**NF-10**: Код должен быть покрыт unit-тестами минимум на 70%
*Идентификатор требования: NF-10*

## Приоритеты требований

| Приоритет | Требования | Описание |
|-----------|------------|----------|
| Высокий | US-1.1, US-1.2, US-1.3, US-1.4 | Базовая функциональность MVP |
| Высокий | US-2.1, US-2.2, US-2.5 | Основные функции динамических правил |
| Средний | US-2.3, US-2.4, US-2.6 | Управление правилами |
| Средний | US-3.1, US-3.2, US-3.5 | Функции ТЗ-3 |
| Низкий | US-3.3, US-3.4, US-3.6 | Дополнительные функции |

## Связь с техническими заданиями

| ТЗ | Требования | Статус |
|----|------------|--------|
| ТЗ-1 | US-1.1, US-1.2, US-1.3, US-1.4, NF-6 | Реализовано |
| ТЗ-2 | US-2.1 - US-2.6, NF-1, NF-2, NF-3, NF-4 | Реализовано |
| ТЗ-3 | US-3.1 - US-3.6, NF-5, NF-7, NF-8, NF-9, NF-10 | Реализовано |

## Тестовые сценарии

Для проверки базовой функциональности (ТЗ-1) предусмотрены тестовые пользователи:

| Пользователь (UUID) | Ожидаемые рекомендации |
|---------------------|------------------------|
| `cd515076-5d8a-44be-930e-8d4fcb79f42d` | Invest 500 |
| `d4a4d619-9a0c-4fc5-b0cb-76c49409546b` | Top Saving |
| `1f9b149c-6577-448a-bc94-16bea229b71a` | Простой кредит |